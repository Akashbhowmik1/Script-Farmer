const scripts = [
    {
        name: "Blox Fruit Auto Farm",
        game: "Blox Fruits",
        category: "Adventure",
        description: "A script for Blox Fruits with auto-farm and stats boost.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/newredz/BloxFruits/refs/heads/main/Source.luau"))`,
        popularity: 100,
        dateAdded: "2025-05-01"
    },
    {
        name: "Adopt Me Pet Collector",
        game: "Adopt Me",
        category: "Simulation",
        description: "A script for Adopt Me with pet auto-collect.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/JusticeValley/Antarctic-Hub/main/New.lua", true))()`,
        popularity: 90,
        dateAdded: "2025-04-15"
    },
    {
        name: "Brookhaven Money Hack",
        game: "Brookhaven",
        category: "Roleplay",
        description: "A script for Brookhaven to boost in-game currency.",
        code: `loadstring(game:HttpGet("https://rawscripts.net/raw/Brookhaven-RP-Sander-XY-35845"))()`,
        popularity: 85,
        dateAdded: "2025-03-20"
    },
    {
        name: "Dead Rails Auto Bonds And More",
        game: "Dead Rails",
        category: "Adventure",
        description: "A script for Dead Rails to automate resource gathering.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/ArdyBotzz/NatHub/refs/heads/master/NatHub.lua"))()`,
        popularity: 70,
        dateAdded: "2025-05-10"
    },
    {
        name: "Blue Lock Rivals Speed and Hit-box Boost",
        game: "Blue Lock Rivals",
        category: "Sports",
        description: "A script for Blue Lock Rivals to enhance player skills.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/Ultik-max/Isisis/refs/heads/main/Protected_9713416812708883.txt"))()`,
        popularity: 65,
        dateAdded: "2025-04-25"
    },
    {
        name: "Arise Crossover Auto Farm",
        game: "Arise Crossover",
        category: "Adventure",
        description: "A script for Arise Crossover Auto farm.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/Omgshit/Scripts/main/MainLoader.lua"))()`,
        popularity: 60,
        dateAdded: "2025-05-05"
    },
    {
        name: "Doors Speedrun Hack",
        game: "Doors",
        category: "Horror",
        description: "A script for Doors to speed up navigation through levels.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/CatEnddroid/Kitty-Cats-Doors-Beta/refs/heads/main/hub.lua"))()`,
        popularity: 75,
        dateAdded: "2025-04-10"
    },
    {
        name: "Forsaken Auto Battle",
        game: "Forsaken",
        category: "Action",
        description: "A script for Forsaken to automate combat sequences.",
        code: `loadstring(game:HttpGet('https://raw.githubusercontent.com/sigmaboy-sigma-boy/sigmaboy-sigma-boy/refs/heads/main/StaminaSettings.ESP.PIDC.raw"))()`,
        popularity: 80,
        dateAdded: "2025-05-12"
    },
    {
        name: "Tower Defense Simulator Auto Wave",
        game: "Tower Defense Simulator",
        category: "Strategy",
        description: "A script for Tower Defense Simulator to automate wave defense.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/Prosexy/Demonic-HUB-V2/main/DemonicHub_V2.lua", true))()`,
        popularity: 85,
        dateAdded: "2025-04-20"
    },
    {
        name: "The Strongest Battlegrounds Combo Hack",
        game: "The Strongest Battlegrounds",
        category: "Fighting",
        description: "A script for The Strongest Battlegrounds to optimize combat combos.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/yes1nt/yes/refs/heads/main/CHAINSAW%20MAN/Chainsaw%20Man%20(Obfuscated).txt"))()`,
        popularity: 95,
        dateAdded: "2025-05-08"
    },
    {
        name: "Fisch Auto Farm",
        game: "Fisch",
        category: "Simulation",
        description: "A script for Fisch to automate resource collection.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/Skzuppy/forge-hub/main/loader.lua"))()`,
        popularity: 60,
        dateAdded: "2025-04-05"
    },
    {
        name: "Jujutsu Shenanigans Auto Skill",
        game: "Jujutsu Shenanigans",
        category: "Fighting",
        description: "A script for Jujutsu Shenanigans to automate skill usage.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/PawsThePaw/Plutonium.AA/main/Plutonium.Loader.lua", true))()`,
        popularity: 70,
        dateAdded: "2025-05-03"
    },
    {
        name: "Realistic Street Soccer Hit-Box Boost etc.",
        game: "Realistic Street Soccer",
        category: "Sports",
        description: "A script for Realistic Street Soccer to enhance trick performance.",
        code: `loadstring(game:HttpGet("https://rawscripts.net/raw/Realistic-Street-Soccer-rayan-s-hub-SOlARA-SUPORT-39402"))()`,
        popularity: 65,
        dateAdded: "2025-04-12"
    },
    {
        name: "Bubble Gum Simulator Auto Bubble",
        game: "Bubble Gum Simulator",
        category: "Simulation",
        description: "A script for Bubble Gum Simulator to automate bubble collection.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/MIKEDRIPZOWSKU/test/refs/heads/main/SmorgsHubBGSI.lua", true))()`,
        popularity: 95,
        dateAdded: "2025-04-12"
    },
    {
        name: "Grow a Garden Auto Harvest Auto Sell etc.",
        game: "Grow a Garden",
        category: "Simulation",
        description: "A script for Grow a Garden to automate plant harvesting and resource collection.",
        code: `loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/NoLag-id/No-Lag-HUB/refs/heads/main/Loader/LoaderV1.lua"))()`,
        popularity: 75,
        dateAdded: "2025-05-15"
    },
    {
        name: "Anime Vanguards Auto Mission",
        game: "Anime Vanguards",
        category: "Adventure",
        description: "A script for Anime Vanguards to automate mission completion.",
        code: `loadstring(game:HttpGet('https://raw.githubusercontent.com/godor1010/godor/refs/heads/main/anime_vanguards_'))()`,
        popularity: 80,
        dateAdded: "2025-05-06"
    },
    {
        name: "Anime Rangers X Auto Grind",
        game: "Anime Rangers X",
        category: "Adventure",
        description: "A script for Anime Rangers X to automate grinding tasks.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/OhhMyGehlee/yu/refs/heads/main/tu"))();`,
        popularity: 70,
        dateAdded: "2025-04-18"
    },
    {
        name: "Attack on Titan Revolution Titan Slayer",
        game: "Attack on Titan Revolution",
        category: "Action",
        description: "A script for Attack on Titan Revolution to optimize titan slaying.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/zerunquist/TekkitAotr/refs/heads/main/main"))()`,
        popularity: 85,
        dateAdded: "2025-05-09"
    },
    {
        name: "Blade Ball Auto Dodge",
        game: "Blade Ball",
        category: "Sports",
        description: "A script for Blade Ball to automate dodging mechanics.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/ImNotRox1/Trous-Hub/refs/heads/main/blade-ball.lua"))`,
        popularity: 90,
        dateAdded: "2025-04-22"
    },
    {
        name: "Pet Simulator 99 Auto Pet",
        game: "Pet Simulator 99",
        category: "Simulation",
        description: "A script for Pet Simulator 99 to automate pet collection.",
        code: `loadstring(game:HttpGet('https://raw.githubusercontent.com/SlamminPig/6FootScripts/main/Scripts/PetSimulator99.lua'))()`,
        popularity: 95,
        dateAdded: "2025-05-11"
    },
    {
        name: "Arsenal aim bot",
        game: "Arsenal",
        category: "Action",
        description: "A script for Arsenal to Silent Aimbot Wallbang.",
        code: `loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Express-Hub-Free-Universal-GUI-V6-30568"))()`,
        popularity: 80,
        dateAdded: "2025-05-11"
    },
    {
        name: "Tower Of Hell speed hack",
        game: "Tower of Hell",
        category: "Parkour",
        description: "A script for Tower Of Hell walk speed jump boost.",
        code: `loadstring(game:HttpGet("https://gist.githubusercontent.com/BloxiYT/85f97364b6367baac677e109488c9905/raw/c2972a2b892c4193509ddb2fe1ba3061435e1a8a/gistfile1.txt"))()`,
        popularity: 80,
        dateAdded: "2025-05-11"
    },
    {
        name: "Jailbreak Auto Rob And More.",
        game: "Jailbreak",
        category: "Open World",
        description: "A script for Jailbreak.",
        code: `loadstring(game:HttpGet('https://raw.githubusercontent.com/BlitzIsKing/UniversalFarm/main/Loader/Regular'))()`,
        popularity: 90,
        dateAdded: "2025-05-11"
    },
    {
        name: "Murder Mystery 2 Auto Win",
        game: "Murder Mystery 2",
        category: "Action",
        description: "A script for Murder Mystery 2 to automatically win rounds.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/CycleScripts/Official/refs/heads/main/freemium"))()`,
        popularity: 85,
        dateAdded: "2025-05-20"
    },
    {
        name: "Phantom Forces Aimbot",
        game: "Phantom Forces",
        category: "Action",
        description: "A script for Phantom Forces to assist with aiming and shooting.",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/dementiaenjoyer/homohack/main/homohack.lua"))()`,
        popularity: 90,
        dateAdded: "2025-05-20"
    },
    {
        name: "Anime Fighting Simulator Auto Train",
        game: "Anime Fighting Simulator",
        category: "Fighting",
        description: "A script for Anime Fighting Simulator to automate training and power-ups.",
        code: `loadstring(game:HttpGet("https://rawscripts.net/raw/DIMENSION-6-Anime-Fighting-Simulator-Data-Roll-back-7000"))()`,
        popularity: 95,
        dateAdded: "2025-05-21"
    },
    {
        name: "Pet Simulator X Auto Farm",
        game: "Pet Simulator X",
        category: "Simulation",
        description: "A script for Pet Simulator X to automate pet collection and farming.",
        code: `loadstring(game:HttpGet('https://raw.githubusercontent.com/RunDTM/ZeeroxHub/main/Loader.lua'))()`,
        popularity: 90,
        dateAdded: "2025-05-21"
    }
];





let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

const isFavorite = (scriptName) => {
    if (typeof scriptName !== 'string' || !scriptName.trim()) {
        console.warn('Invalid script name provided to isFavorite:', scriptName);
        return false;
    }
    return favorites.includes(scriptName.trim());
};

const toggleFavorite = (scriptName) => {
    if (typeof scriptName !== 'string' || !scriptName.trim()) {
        console.warn('Invalid script name for toggleFavorite:', scriptName);
        return;
    }
    scriptName = scriptName.trim();

    // Check if script exists
    const scriptExists = scripts.some(script => script.name === scriptName);
    if (!scriptExists) {
        console.warn(`Script '${scriptName}' not found in scripts array.`);
        return;
    }

    // Toggle favorite state
    const isCurrentlyFavorite = isFavorite(scriptName);
    if (isCurrentlyFavorite) {
        favorites = favorites.filter(name => name !== scriptName);
    } else {
        favorites.push(scriptName);
    }

    // Update localStorage
    try {
        localStorage.setItem('favorites', JSON.stringify(favorites));
    } catch (error) {
        console.error('Failed to update localStorage:', error);
        return;
    }

    // Update the specific favorite button
    const favoriteButtons = document.querySelectorAll(`.favorite-btn[onclick="toggleFavorite('${scriptName}')"]`);
    favoriteButtons.forEach(button => {
        button.innerHTML = isCurrentlyFavorite ? '<i class="far fa-heart"></i>' : '<i class="fas fa-heart"></i>';
        button.classList.toggle('favorited', !isCurrentlyFavorite);
        button.setAttribute('aria-label', isCurrentlyFavorite ? `Add ${scriptName} to favorites` : `Remove ${scriptName} from favorites`);
        button.classList.remove('animate');
        void button.offsetWidth; // Trigger reflow
        button.classList.add('animate');
    });

   // Refresh display only if favorites filter is active
const showFavorites = document.getElementById('showFavorites');
if (showFavorites && showFavorites.checked) {
    filterScripts();
}

};

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('hide');
        setTimeout(() => {
            modal.style.display = 'none';
            modal.classList.remove('hide');
        }, 300);
    } else {
        console.warn(`Modal with ID '${modalId}' not found.`);
    }
}

function showCode(scriptName) {
    const script = scripts.find(s => s.name === scriptName);
    const modal = document.getElementById('scriptModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalGame = document.getElementById('modalGame');
    const modalDescription = document.getElementById('modalDescription');
    const modalCode = document.getElementById('modalCode');
    const modalContent = document.querySelector('#scriptModal .modal-content');

    if (!script || !modal || !modalTitle || !modalGame || !modalDescription || !modalCode || !modalContent) {
        console.error('Script or modal elements not found.');
        alert(`Script '${scriptName}' not found or modal elements missing.`);
        return;
    }

    modalTitle.textContent = script.name;
    modalGame.innerHTML = `<strong>Game:</strong> ${script.game} <br><strong>Category:</strong> ${script.category}`;
    modalDescription.textContent = script.description;
    modalCode.textContent = script.code;

    let copyButton = modalContent.querySelector('.copy-btn');
    if (!copyButton) {
        copyButton = document.createElement('button');
        copyButton.className = 'copy-btn';
        copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy Code';
        copyButton.setAttribute('aria-label', 'Copy script code');
        modalContent.insertBefore(copyButton, modalContent.querySelector('pre'));
    }

    copyButton.onclick = () => {
        navigator.clipboard.writeText(script.code)
            .then(() => {
                copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => { copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy Code'; }, 2000);
            })
            .catch(err => {
                console.error('Failed to copy code:', err);
                alert('Failed to copy code. Please try again.');
            });
    };

    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');
    modal.focus();
    hljs.highlightElement(modalCode);
}

document.addEventListener('DOMContentLoaded', () => {
    hljs.highlightAll();

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
        themeToggle.innerHTML = `<i class="fas fa-${currentTheme === 'light' ? 'moon' : 'sun'}"></i> ${currentTheme === 'light' ? 'Dark' : 'Light'} Mode`;
        localStorage.setItem('theme', currentTheme);
    });

    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.innerHTML = `<i class="fas fa-${savedTheme === 'light' ? 'moon' : 'sun'}"></i> ${savedTheme === 'light' ? 'Dark' : 'Light'} Mode`;

    // Overlay menu toggle
    const hamburger = document.querySelector('.hamburger');
    const overlayMenu = document.getElementById('overlayMenu');
    hamburger.addEventListener('click', () => {
        const isOpen = overlayMenu.classList.toggle('active');
        hamburger.classList.toggle('active');
        hamburger.setAttribute('aria-expanded', isOpen.toString());
        overlayMenu.setAttribute('aria-hidden', (!isOpen).toString());
        if (isOpen) {
            overlayMenu.focus();
        }
    });

    // Close overlay when clicking outside
    overlayMenu.addEventListener('click', (e) => {
        if (e.target === overlayMenu) {
            overlayMenu.classList.remove('active');
            hamburger.classList.remove('active');
            hamburger.setAttribute('aria-expanded', 'false');
            overlayMenu.setAttribute('aria-hidden', 'true');
        }
    });

    // Focus trap for overlay menu
    overlayMenu.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
            const focusableElements = overlayMenu.querySelectorAll('a, button');
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            if (e.shiftKey && document.activeElement === firstElement) {
                e.preventDefault();
                lastElement.focus();
            } else if (!e.shiftKey && document.activeElement === lastElement) {
                e.preventDefault();
                firstElement.focus();
            }
        }
    });

    // Close overlay and modals on Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            overlayMenu.classList.remove('active');
            hamburger.classList.remove('active');
            hamburger.setAttribute('aria-expanded', 'false');
            overlayMenu.setAttribute('aria-hidden', 'true');
            closeModal('scriptModal');
            closeModal('aboutModal');
            closeModal('contactModal');
        }
    });

    // About modal toggle
    const aboutBtn = document.getElementById('aboutBtn');
    const aboutModal = document.getElementById('aboutModal');
    aboutBtn.addEventListener('click', () => {
        aboutModal.style.display = 'flex';
        aboutModal.setAttribute('aria-hidden', 'false');
        aboutModal.focus();
        overlayMenu.classList.remove('active');
        hamburger.classList.remove('active');
        hamburger.setAttribute('aria-expanded', 'false');
        overlayMenu.setAttribute('aria-hidden', 'true');
    });

    // Contact modal toggle
    const contactBtn = document.getElementById('contactBtn');
    const contactModal = document.getElementById('contactModal');
    contactBtn.addEventListener('click', () => {
        contactModal.style.display = 'flex';
        contactModal.setAttribute('aria-hidden', 'false');
        contactModal.focus();
        overlayMenu.classList.remove('active');
        hamburger.classList.remove('active');
        hamburger.setAttribute('aria-expanded', 'false');
        overlayMenu.setAttribute('aria-hidden', 'true');
    });

    // Modal click to close
    [document.getElementById('scriptModal'), aboutModal, contactModal].forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal(modal.id);
            }
        });
    });

    // Focus trap for modals
    [document.getElementById('scriptModal'), aboutModal, contactModal].forEach(modal => {
        modal.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                const focusableElements = modal.querySelectorAll('button, a, [tabindex="0"]');
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        });
    });

    // Pagination
    let currentPage = 1;
    const scriptsPerPage = 40;

    // Utility function to debounce input events
    const debounce = (func, delay) => {
        let timeoutId;
        return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func.apply(null, args), delay);
        };
    };

    // Function to create a script card
    const createScriptCard = (script) => {
        const scriptCard = document.createElement('div');
        scriptCard.className = 'script-card';
        scriptCard.setAttribute('role', 'article');
        scriptCard.innerHTML = `
            <h3>${script.name}</h3>
            <p><strong>Game:</strong> ${script.game}</p>
            <p><strong>Category:</strong> ${script.category}</p>
            <p>${script.description}</p>
            <div class="buttons">
                <button onclick="showCode('${script.name}')" aria-label="View code for ${script.name}"><i class="fas fa-code"></i> View Code</button>
                <button class="favorite-btn${isFavorite(script.name) ? ' favorited' : ''}" onclick="toggleFavorite('${script.name}')" aria-label="${isFavorite(script.name) ? 'Remove from' : 'Add to'} favorites" data-script-name="${script.name}">
                    ${isFavorite(script.name) ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>'}
                </button>
            </div>
        `;
        return scriptCard;
    };

    // Function to display scripts with loading state
    const displayScripts = (scriptsToShow) => {
        const scriptsGrid = document.getElementById('scriptsGrid');
        const noResults = document.getElementById('noResults');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const pageInfo = document.getElementById('pageInfo');

        if (!scriptsGrid || !noResults || !prevPage || !nextPage || !pageInfo) {
            console.error('Required DOM elements not found.');
            return;
        }

        scriptsGrid.style.opacity = '0.5';
        scriptsGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Loading scripts...</div>';

        setTimeout(() => {
            scriptsGrid.innerHTML = '';
            scriptsGrid.style.opacity = '1';

            if (scriptsToShow.length === 0) {
                noResults.style.display = 'block';
                prevPage.disabled = true;
                nextPage.disabled = true;
                pageInfo.textContent = 'Page 0 of 0';
                return;
            }

            noResults.style.display = 'none';
            const start = (currentPage - 1) * scriptsPerPage;
            const end = start + scriptsPerPage;
            const paginatedScripts = scriptsToShow.slice(start, end);

            const fragment = document.createDocumentFragment();
            paginatedScripts.forEach(script => {
                fragment.appendChild(createScriptCard(script));
            });
            scriptsGrid.appendChild(fragment);

            const totalPages = Math.ceil(scriptsToShow.length / scriptsPerPage);
            prevPage.disabled = currentPage === 1;
            nextPage.disabled = currentPage === totalPages;
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        }, 500);
    };

    // Function to filter and sort scripts
    const filterScripts = () => {
        const searchInput = document.getElementById('searchInput');
        const gameFilter = document.getElementById('gameFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const sortFilter = document.getElementById('sortFilter');
        const showFavorites = document.getElementById('showFavorites');

        if (!searchInput || !gameFilter || !categoryFilter || !sortFilter || !showFavorites) {
            console.error('Filter elements not found.');
            return;
        }

        const searchTerm = searchInput.value.trim().toLowerCase();
        const selectedGame = gameFilter.value;
        const selectedCategory = categoryFilter.value;
        const sortBy = sortFilter.value;
        const showFavoritesOnly = showFavorites.checked;

        let filteredScripts = scripts.filter(script => {
            const searchFields = [
                script.name.toLowerCase(),
                script.game.toLowerCase(),
                script.category.toLowerCase(),
                script.description.toLowerCase()
            ];
            const matchesSearch = searchTerm === '' || searchFields.some(field => field.includes(searchTerm));
            const matchesGame = selectedGame === '' || script.game === selectedGame;
            const matchesCategory = selectedCategory === '' || script.category === selectedCategory;
            const matchesFavorites = !showFavoritesOnly || isFavorite(script.name);
            return matchesSearch && matchesGame && matchesCategory && matchesFavorites;
        });

        if (sortBy === 'popularity') {
            filteredScripts.sort((a, b) => b.popularity - a.popularity);
        } else if (sortBy === 'newest') {
            filteredScripts.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
        } else {
            filteredScripts.sort((a, b) => a.name.localeCompare(b.name));
        }

        currentPage = 1;
        displayScripts(filteredScripts);
    };

    // Initialize event listeners
    const initEventListeners = () => {
        const searchInput = document.getElementById('searchInput');
        const gameFilter = document.getElementById('gameFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const sortFilter = document.getElementById('sortFilter');
        const showFavorites = document.getElementById('showFavorites');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const scriptsGrid = document.getElementById('scriptsGrid');

        if (!searchInput || !gameFilter || !categoryFilter || !sortFilter || !showFavorites || !prevPage || !nextPage || !scriptsGrid) {
            console.error('Search input field or DOM elements for event listeners not found.');
            return;
        }

        const debouncedFilter = debounce(filterScripts, 300);
        searchInput.addEventListener('input', debouncedFilter);
        gameFilter.addEventListener('change', filterScripts);
        categoryFilter.addEventListener('change', filterScripts);
        sortFilter.addEventListener('change', filterScripts);
        showFavorites.addEventListener('change', filterScripts);

        searchInput.addEventListener('touchstart', () => {
            searchInput.focus();
        });
        [gameFilter, categoryFilter, sortFilter].forEach(select => {
            select.addEventListener('touchstart', () => {
                select.focus();
            });
        });
        showFavorites.addEventListener('touchstart', () => {
            showFavorites.focus();
        });

        prevPage.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                filterScripts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        nextPage.addEventListener('click', () => {
            if (currentPage < Math.ceil(scripts.length / scriptsPerPage)) {
                currentPage++;
                filterScripts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Simplified event delegation for favorite buttons
        scriptsGrid.addEventListener('click', (e) => {
            const favoriteBtn = e.target.closest('.favorite-btn');
            if (favoriteBtn) {
                const scriptName = favoriteBtn.dataset.scriptName;
                if (scriptName) {
                    toggleFavorite(scriptName);
                    e.stopPropagation();
                    e.preventDefault(); // Prevent multiple triggers
                } else {
                    console.warn('No data-script-name found on favorite button.');
                }
            }
        });
    };

    // Initialize the app
    const init = () => {
        try {
            initEventListeners();
            filterScripts();
        } catch (error) {
            console.error('Initialization failed:', error);
        }
    };

    init();
});
